
<!DOCTYPE html>
<html>
<head>
<meta charset='UTF-8'>
<title>DB Coding Guidelines</title>
<style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; display: flex; }
    .sidebar { width: 250px; background: #2c3e50; color: white; height: 100vh; padding-top: 20px; }
    .sidebar a { display: block; color: white; padding: 10px 20px; text-decoration: none; cursor: pointer; }
    .sidebar a:hover { background: #34495e; }
    .content { flex: 1; padding: 20px; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    h2 { color: #2c3e50; }
    ul { line-height: 1.6; }
</style>
<script>
    function showTab(tabId) {
        var tabs = document.getElementsByClassName('tab-content');
        for (var i = 0; i < tabs.length; i++) {
            tabs[i].classList.remove('active');
        }
        document.getElementById(tabId).classList.add('active');
    }
</script>
</head>
<body>
<div class='sidebar'>
<a onclick="showTab('Create Table')">Create Table</a><a onclick="showTab('Alter Table')">Alter Table</a><a onclick="showTab('Delete Table')">Delete Table</a><a onclick="showTab('Stored Procedure')">Stored Procedure</a><a onclick="showTab('Baseline')">Baseline</a><a onclick="showTab('Views')">Views</a></div><div class='content'><div id='Create Table' class='tab-content'><h2>Create Table Guidelines</h2><ul><li>1 Must use if not exists statement before creating a new table.</li><li>2 Always prefix table with schema name. </li><li>3 Always create table with Identify column(Not applicable for Deleted tables)</li><li>4 Always define primary key on identity column with clustered index.</li><li>5 Create required foreign keys</li><li>6 a</li><li>7 Use usp_CreateIndex Sp to created indexes instead of baseline script.</li><li>8 Do not create duplicate indexes</li><li>9 Use appropriate datatypes. Example:  for true/false use BIT instead INT, Use TINYINT if value <255 and not required -ve</li><li>10 Use proper length for varchar,nvarchar datatypes. Avoid varchar(max) if possible.</li><li>11 Must specify the name for every constraint (PK,FK and Default constraint)</li><li>12 Do not create duplicate indexes</li><li>13 Table name should not exceed 30 characters.</li><li>14 Do not use numbers/spaces in table name</li><li>15 Must specific NULL/NOT NULL for every column</li><li>16 Always create table in UPPER case</li><li>17 Always create deleted table for the transaction table (Not for Process related tables and baseline tables)</li><li>17 Main table and Deleted table data types/ column lengths should be same</li><li>18 Every table should consists INSERTBY,INSERTDATE,UPDATEBY and UPDATEDATE columns</li><li>19 Must specify the description of table and every column using extended properties.</li></ul></div><div id='Alter Table' class='tab-content'><h2>Alter Table Guidelines</h2><ul><li>Adding new Columns 1 Added newly added column in both main table and deleted table</li><li>2 Use appropriate datatypes. Example:  for true/false use BIT instead INT, Use TINYINT if value <255 and not required -ve</li><li>3 Use proper length for varchar,nvarchar datatypes. Avoid varchar(max) if possible.</li><li>4 If newly created field is mandatory field, must provide script to populate default values in the column for existing data</li><li>5 If required, Add the new created column in IM_TARGETENTITYFIELDs and IM Temp and Archive tables and change the Load SP.</li><li>6 Must specify the description of every column using extended properties.</li><li>7 If any MDV is associated with table, added newly created columns in MDV.</li><li>8 Create indexes if required.</li><li>9 Change get/save SPs and SVs </li><li>10 Added newly added columns in auditing</li><li>11 Add newly added column in ICM_EXPORTMASTERDETAIL and it's child tables.</li><li>Alter existing Columns 1 Perform same operations on main table and deleted table</li><li>2 Check and modify all child tables columns which are referencing the changed column</li><li>3 Identify all database objects which are using the column and modify the length/data type of variables/temp tables.</li><li>4 Identify IM database objects which are using the column and modify the length/data type of variables/temp tables.</li><li>Delete existing columns 1 Inform all implementations before deleting column from table.</li><li>2 Verify and modify all database objects which are using the column to be deleted.</li><li>3 Verify and modify all IM database objects which are using the column to be deleted.</li><li>4 Delete the column from both main and _deleted tables.</li></ul></div><div id='Delete Table' class='tab-content'><h2>Delete Table Guidelines</h2><ul><li>1 Inform all implementations before deleting the table.</li><li>2 Verify and modify all database objects which are using the table to be deleted.</li><li>3 Verify and modify all IM database objects which are using the table to be deleted.</li><li>4 Delete deleted table</li></ul></div><div id='Stored Procedure' class='tab-content'><h2>Stored Procedure Guidelines</h2><ul><li>General 1 Must write the name of Author, Creation Date, Usage and Description of the SP at the beginning of SP( Between As and Begin)</li><li>2 Must specify Modified By, Modify Date and Purpose after modifying the SP</li><li>3 Always prefix SP name with schema name</li><li>4 Always provide drop and create scripts while giving the release.</li><li>5 In case joining more than one table to get/insert/update/delete, must use alias name for each table and prefix the alias for every column used in the query</li><li>6 Do not use INSERT statement without column list</li><li>7 Must follow proper indentation while writing code</li><li>8 Do not take the script of SP from sp_helptext statement, always modify from the object explorer to avoid formatting </li><li>9 While calling child SP/executesql from Parent SP always use Name=value syntax to pass the parameter values.</li><li>10 Always use ANSI syntax</li><li>11 Give proper meaningful names to parameters and local variable</li><li>12 Always prefix parameters with a and local variables with p</li><li>13 Write proper comments for complex logic</li><li>14 Use proper field in where condition when fetch data from common tables to avoid fetching of huge data.</li><li>15 Use Try catch blocks for exception handling.</li><li>16 Do not suppress the exception in catch block. Always raise the exception from catch block</li><li>17 If we join Integer/date column with VARCHAR field, use explicit convert statement to convert the data to varchar to avoid runtime error.</li><li>18 SP name should not exceed 30 charecters</li><li>19 Avoid OPENXML statement to read data from XML</li><li>20 Use Parameterized dynamic SQL to run the dynamic query and avoid SQL injection
Example:
SET @pStatement='SELECT * FROM ' + @pTableName + ' WHERE AGENTID=@AgentID;'
EXECUTE sys.sp_executesql @statement =@pStatement ,@params = N'@AgentID integer',@AgentID = @aAgentID;</li><li>21 If more than one result sets are combined using UNION or UNION ALL operator make sure all the fields should have same data type and length. If we don't specify the length SQL by default take the maximum lengh of all fields.
Example: SELECT 'ABC' UNION ALL SELECT 'ABCD' UNION ALL SELECT NULL then SQL treates maximum length of column as 4 so, rewrite the query as follows.
SELECT CAST( 'ABC'  AS VARCHAR(50)) UNION ALL SELECT CAST('ABCD' AS VARCHAR(50) UNION ALL SELECT NULL </li><li>22 Do not hard code Item name present in the MTOPTION tables in SPs/Wrokflows. Always use OPTIONCODE.</li><li>23 If we convert data from TEXT to XML using FOR XML caluse then use the following logic to avoid conversion issue of special charecters (&, <, > etc…)
OLD CODE: FOR XML PATH('') ) , 2, 200000)
NEW CODE:  FOR XML PATH('') ,type).value('(.//text())[1]','varchar(max)') , 2, 200000)</li><li>Cursors 1 Always use LOCAL keyword while declaring cursor</li><li>2 Use STATIC/FAST_FORWARD keyword to avoid dynamic cursors</li><li>3 CLOSE and DEALLOCATE the cursors at the end</li><li>Performance 1 Avoid sub queries if possible</li><li>2 Avoid functions in where clause if possible</li><li>3 Avoid correlated sub queries if possible</li><li>4 Do not use Parameters directly in where clause, assign the parameters to local variable and use local variable</li><li>5 Avoid cursors if possible</li><li>6 Avoid LEFT JOINs if possible</li><li>7 Use SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED at the beginning of SP to avoid WITH(NOLOCK) for every select statement</li><li>8 Always use SET NOCOUNT ON at the beginning of SP</li><li>9 Do not write PRINT statements in SP</li><li>10 Use temp table instead of table variable for huge amount of data</li><li>11 Create indexes on temp table if necessary</li><li>12 Avoid dynamic SQL if possible</li><li>13 Use CROSS APPLY/OUTER APPLY instead of functions to avoid performance issues.</li><li>Temp tables 1 Give meaningful name for temp tables</li><li>2 If SPs are nested then always suffix the temp table name with Short name of SP. To avoid override of temp table created in main sp by child sp</li><li>3 Always drop the temp tables at the end of SP</li><li>4 Avoid the use of global temp table if possible</li><li>5 If any global temp table is used in SP then always create table name/suffix with Unique identifier</li><li>6 Always use If exists statement when using global temp table in child SPs to avoid runtime errors</li><li>7 Must drop the global temp table at the end of SP and </li><li>Delete SP 1 Delete data from all child/dependent tables before deleting data from parent table</li><li>2 Delete data from UDFIELD table before deleting data from main table</li></ul></div><div id='Baseline' class='tab-content'><h2>Baseline Guidelines</h2><ul><li>1 Always use if not exists statement for insert scripts</li><li>2</li></ul></div><div id='Views' class='tab-content'><h2>Views Guidelines</h2><ul><li>1 Always use WITH VIEW_METADATA keyword for MDVs</li><li>2 Must give alias names for each column in Camel Case</li><li>3 Avoid CTEs in MDV to avoid performance issues</li><li>4 Use WITH (NOLOCK) statement for every table</li><li>5 Must specify Alias name for every table and use prefix every column with Alias name</li><li>6 MDV Name should not exceed 30  charecters</li><li>7 Must write the name of Author, Creation Date and Description of the MDV</li><li>8 Must specify Modified By, Modify Date and Purpose after modifying the MDV</li><li>9 All Base MDVs consists all the columns present in the underlying table.</li><li>10 If we have any IDs in base table which are referring the other table then, in MDV we should have name/code of the referred tables.
Example: If we have STUTUSID in base table which is referring MTOPTION table then, MDV should consists both StatusID and Status fields.</li><li>11 Use the proper aliases for each table used in MDV and every column should be prefixed with the Alias name.</li><li>12 If we have any bit/Boolean field in table then, in MDV add a new column and write case statement to display “Yes” and “No” along with regular field.
Example: If we have ISAPPILCABLE field in table then we should have IsApplicable and Applicable fields in MDV. IsApplicable should return 1/0 and Applicable should return “Yes”/”No”</li><li>13 Give user friendly name for the every column of the MDV. </li></ul></div></div></body></html>
